[workspace]
authors = ["ollie-desktop <buitelaarolivier@gmail.com>"]
channels = ["conda-forge"]
name = "ugro"
platforms = ["linux-64"]
version = "0.1.0"


# ============================================================================
# Dependencies
# ============================================================================

[dependencies]
python = "3.12.*"
python-dotenv = ">=1.2.1,<2"
flask = ">=3.1.2,<4"
fastapi = ">=0.109.0"
uvicorn = ">=0.27.0"


# ============================================================================
# PyPI Dependencies
# ============================================================================

[pypi-dependencies]
click = ">=8.1.0"
pyyaml = ">=6.0"
pydantic = ">=2.0"
typer = ">=0.9.0"
rich = ">=13.0.0"
paramiko = ">=3.0"
psutil = ">=5.9.0"
requests = ">=2.31.0"
redis = ">=5.0.0"
ugro = { path = ".", editable = true }


# ============================================================================
# CUDA Feature
# ===========================================================================

[feature.cuda.system-requirements]
cuda = "12.8"

[feature.cuda.pypi-dependencies]
torch = { version = "==2.7.1", index = "https://download.pytorch.org/whl/cu128" }
torchvision = { version = "==0.22.1", index = "https://download.pytorch.org/whl/cu128" }
torchaudio = { version = "==2.7.1", index = "https://download.pytorch.org/whl/cu128" }
transformers = ">=4.57.6, <5"
accelerate = ">=1.12.0, <2"
bitsandbytes = ">=0.49.1, <0.50"
sentencepiece = ">=0.2.1, <0.3"
protobuf = "*"
optimum-quanto = ">=0.2.7, <0.3"

[feature.cuda.dependencies]
cuda-version = "12.8.*"
gcc_linux-64 = "12.*"
gxx_linux-64 = "12.*"
git = ">=2.51.0,<3"

# ============================================================================
# Test Feature
# ============================================================================

[feature.test.dependencies]
pytest = ">=7.0"
pytest-asyncio = ">=0.23"
pytest-cov = ">=4.0"
black = ">=23.0"
ruff = ">=0.1.0"
mypy = ">=1.0"


# ============================================================================
# Monitor Features
# ============================================================================

[feature.monitor.pypi-dependencies]
prometheus-client = ">=0.17.0"
flask = ">=2.3.0"


# ============================================================================
# Environments
# ============================================================================

[environments]
default = { features = [], solve-group = "default" }
monitor = { features = ["monitor"], solve-group = "default" }
test = { features = ["test", "monitor"], solve-group = "default" }
cuda = { features = ["cuda"], solve-group = "default" }

# ============================================================================
# Tasks
# ============================================================================

[tasks]
ugro = "python -m ugro.cli"
ugro-health = "python -m ugro.cli health"
ugro-test-health = "python src/test_cluster_health.py"
test = "pytest -q"
cov = "pytest --cov=ugro --cov-report=term-missing"
lint = "ruff check ."
fmt = "black ."
typecheck = "mypy ."
monitor = "python -m ugro.monitor"
