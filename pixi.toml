[workspace]
authors = ["ollie-desktop <buitelaarolivier@gmail.com>"]
channels = ["conda-forge", "pytorch", "nvidia"]
name = "ugro"
platforms = ["linux-64"]
version = "0.1.0"


# ============================================================================
# Dependencies
# ============================================================================

[dependencies]
python = "3.10.*"
python-dotenv = ">=1.2.1,<2"

[feature.cuda.system-requirements]
cuda = "12.0"


# ============================================================================
# PyPI Dependencies
# ============================================================================

[pypi-dependencies]
click = ">=8.1.0"
pyyaml = ">=6.0"
pydantic = ">=2.0"
paramiko = ">=3.0"
psutil = ">=5.9.0"
requests = ">=2.31.0"
ugro = { path = ".", editable = true }


# ============================================================================
# CPU Feature - CPU-only PyTorch
# ============================================================================

[feature.cpu.dependencies]

[feature.cpu.pypi-dependencies]
torch = { version = "==2.7.1", index = "https://download.pytorch.org/whl/cpu" }
torchvision = { version = "==0.22.1", index = "https://download.pytorch.org/whl/cpu" }
torchaudio = { version = "==2.7.1", index = "https://download.pytorch.org/whl/cpu" }


# ============================================================================
# GPU Feature - CUDA PyTorch
# ============================================================================

[feature.cuda.dependencies]
gcc_linux-64 = "12.*"
gxx_linux-64 = "12.*"
git = ">=2.51.0,<3"

[feature.cuda.pypi-dependencies]
torch = { version = "==2.7.1", index = "https://download.pytorch.org/whl/cu128" }
torchvision = { version = "==0.22.1", index = "https://download.pytorch.org/whl/cu128" }
torchaudio = { version = "==2.7.1", index = "https://download.pytorch.org/whl/cu128" }


# ============================================================================
# Test Feature
# ============================================================================

[feature.test.dependencies]
pytest = ">=7.0"
pytest-cov = ">=4.0"
black = ">=23.0"
ruff = ">=0.1.0"
mypy = ">=1.0"


# ============================================================================
# Monitor Features
# ============================================================================

[feature.monitor.pypi-dependencies]
prometheus-client = ">=0.17.0"
flask = ">=2.3.0"


# ============================================================================
# Environments
# ============================================================================

[environments]
default = { features = [], solve-group = "default" }
cuda = { features = ["cuda"], solve-group = "default" }
monitor = { features = ["monitor"], solve-group = "default" }
test = { features = ["test"], solve-group = "default" }
cpu = { features = ["cpu"] }


# ============================================================================
# Tasks
# ============================================================================

[tasks]
ugro = "python -m ugro.cli"
test = "pytest -q"
cov = "pytest --cov=ugro --cov-report=term-missing"
lint = "ruff check ."
fmt = "black ."
typecheck = "mypy ."
monitor = "python -m ugro.monitor"
